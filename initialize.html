<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Инициализация MASSAGE PRO</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #f5f5f5; }
        .section { background: white; padding: 20px; margin: 20px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        button { background: #ff6b35; color: white; border: none; padding: 12px 24px; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #e55a2b; }
        .success { color: #10b981; font-weight: bold; }
        .info { background: #e3f2fd; padding: 10px; border-radius: 4px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>Инициализация системы MASSAGE PRO</h1>
    
    <div class="section">
        <h2>1. Базовые настройки</h2>
        <button onclick="initializeDefaults()">Установить начальные данные</button>
        <button onclick="clearAll()">Очистить все данные</button>
        <div id="status1"></div>
    </div>
    
    <div class="section">
        <h2>2. Тестовые данные</h2>
        <button onclick="addTestBookings()">Добавить тестовые записи</button>
        <button onclick="addSampleImages()">Добавить примеры изображений</button>
        <div id="status2"></div>
    </div>
    
    <div class="section">
        <h2>3. Проверка системы</h2>
        <button onclick="checkSystem()">Проверить все компоненты</button>
        <div id="status3"></div>
    </div>
    
    <script>
        function initializeDefaults() {
            // Услуги по умолчанию
            const defaultServices = {
                classic: { 
                    name: 'Классический массаж', 
                    price: 180, 
                    duration: 60, 
                    icon: 'fa-hand-paper',
                    description: 'Традиционный расслабляющий массаж всего тела'
                },
                sports: { 
                    name: 'Спортивный массаж', 
                    price: 220, 
                    duration: 60, 
                    icon: 'fa-dumbbell',
                    description: 'Специализированный массаж для спортсменов'
                },
                relax: { 
                    name: 'Релакс массаж', 
                    price: 200, 
                    duration: 75, 
                    icon: 'fa-spa',
                    description: 'Глубокое расслабление и снятие стресса'
                },
                deep: { 
                    name: 'Глубокий массаж', 
                    price: 250, 
                    duration: 60, 
                    icon: 'fa-fire',
                    description: 'Интенсивная работа с глубокими тканями'
                }
            };
            
            // Контент по умолчанию
            const defaultContent = {
                businessName: 'MASSAGE PRO',
                businessPhone: '+972-50-123-4567',
                whatsappPhone: '972501234567',
                businessAddress: 'ул. Дизенгоф 125, Тель-Авив',
                aboutText: 'Добро пожаловать в MASSAGE PRO! Мы предлагаем профессиональные массажные услуги в центре Тель-Авива. Наш опытный массажист поможет вам расслабиться, снять напряжение и улучшить самочувствие. Используем только проверенные техники и индивидуальный подход к каждому клиенту.'
            };
            
            // Настройки по умолчанию
            const defaultSettings = {
                workStart: '09:00',
                workEnd: '21:00',
                defaultDuration: 60,
                slotInterval: 30
            };
            
            // Настройки изображений
            const imageSettings = {
                maxFileSize: 50 * 1024 * 1024,
                compressionQuality: 0.7,
                autoCompress: true,
                maxImagesPerCategory: 10
            };
            
            // Сохраняем все
            localStorage.setItem('massageServices', JSON.stringify(defaultServices));
            localStorage.setItem('massageContent', JSON.stringify(defaultContent));
            localStorage.setItem('massageSettings', JSON.stringify(defaultSettings));
            localStorage.setItem('imageSettings', JSON.stringify(imageSettings));
            
            // Инициализируем пустые массивы
            if (!localStorage.getItem('massageBookings')) {
                localStorage.setItem('massageBookings', '[]');
            }
            if (!localStorage.getItem('massageImages')) {
                localStorage.setItem('massageImages', '{}');
            }
            
            document.getElementById('status1').innerHTML = '<p class="success"> Начальные данные установлены!</p>';
            
            // Показываем что установлено
            const info = `
                <div class="info">
                    <strong>Установлено:</strong><br>
                    - Услуги: ${Object.keys(defaultServices).length}<br>
                    - Название: ${defaultContent.businessName}<br>
                    - Телефон: ${defaultContent.businessPhone}<br>
                    - Адрес: ${defaultContent.businessAddress}<br>
                    - Рабочие часы: ${defaultSettings.workStart} - ${defaultSettings.workEnd}
                </div>
            `;
            document.getElementById('status1').innerHTML += info;
        }
        
        function clearAll() {
            if (confirm('Это удалит ВСЕ данные. Вы уверены?')) {
                localStorage.clear();
                document.getElementById('status1').innerHTML = '<p class="success"> Все данные удалены!</p>';
            }
        }
        
        function addTestBookings() {
            const bookings = JSON.parse(localStorage.getItem('massageBookings') || '[]');
            const services = JSON.parse(localStorage.getItem('massageServices') || '{}');
            
            // Добавляем несколько тестовых записей
            const today = new Date();
            const testBookings = [
                {
                    id: 'BK' + Date.now() + '1',
                    service: services.classic,
                    date: new Date(today.getTime() + 86400000).toISOString().split('T')[0], // Завтра
                    time: '10:00',
                    client: {
                        name: 'Тестовый клиент 1',
                        phone: '+972501234567'
                    },
                    status: 'confirmed',
                    createdAt: new Date().toISOString()
                },
                {
                    id: 'BK' + Date.now() + '2',
                    service: services.sports,
                    date: new Date(today.getTime() + 172800000).toISOString().split('T')[0], // Послезавтра
                    time: '14:00',
                    client: {
                        name: 'Тестовый клиент 2',
                        phone: '+972501234568'
                    },
                    status: 'confirmed',
                    createdAt: new Date().toISOString()
                }
            ];
            
            bookings.push(...testBookings);
            localStorage.setItem('massageBookings', JSON.stringify(bookings));
            
            document.getElementById('status2').innerHTML = '<p class="success"> Добавлено 2 тестовые записи!</p>';
        }
        
        function addSampleImages() {
            // Создаем примеры base64 изображений (1x1 пиксель разных цветов)
            const sampleImages = {
                profile: [{
                    id: 'img_sample_1',
                    data: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==',
                    optimized: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==',
                    filename: 'sample-profile.png',
                    uploadedAt: new Date().toISOString()
                }],
                hero: [{
                    id: 'img_sample_2',
                    data: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==',
                    optimized: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==',
                    filename: 'sample-hero.png',
                    uploadedAt: new Date().toISOString()
                }]
            };
            
            localStorage.setItem('massageImages', JSON.stringify(sampleImages));
            document.getElementById('status2').innerHTML += '<p class="success"> Добавлены примеры изображений!</p>';
            document.getElementById('status2').innerHTML += '<p class="info">Примечание: Это тестовые изображения 1x1 пиксель. Загрузите настоящие через админ-панель.</p>';
        }
        
        function checkSystem() {
            const results = [];
            
            // Проверяем наличие всех ключевых данных
            const requiredKeys = [
                'massageServices',
                'massageContent', 
                'massageSettings',
                'massageBookings',
                'massageImages'
            ];
            
            requiredKeys.forEach(key => {
                const data = localStorage.getItem(key);
                if (data) {
                    try {
                        const parsed = JSON.parse(data);
                        const size = data.length;
                        const count = Array.isArray(parsed) ? parsed.length : Object.keys(parsed).length;
                        results.push(` ${key}: ${count} элементов (${(size/1024).toFixed(1)} KB)`);
                    } catch (e) {
                        results.push(` ${key}: Ошибка парсинга`);
                    }
                } else {
                    results.push(` ${key}: Отсутствует`);
                }
            });
            
            // Общий размер
            const totalSize = new Blob(Object.values(localStorage)).size / 1024 / 1024;
            results.push(`<br><strong>Общий размер localStorage:</strong> ${totalSize.toFixed(2)} MB`);
            
            // Проверка работоспособности
            results.push(`<br><strong>Статус системы:</strong>`);
            
            const services = JSON.parse(localStorage.getItem('massageServices') || '{}');
            const content = JSON.parse(localStorage.getItem('massageContent') || '{}');
            
            if (Object.keys(services).length > 0 && content.businessName) {
                results.push(' Система готова к работе');
            } else {
                results.push(' Требуется инициализация (нажмите "Установить начальные данные")');
            }
            
            document.getElementById('status3').innerHTML = results.join('<br>');
        }
        
        // Автоматическая проверка при загрузке
        window.onload = function() {
            checkSystem();
            
            // Если система пустая, предлагаем инициализацию
            const services = localStorage.getItem('massageServices');
            if (!services || services === '{}') {
                document.getElementById('status1').innerHTML = '<p style="color: #ff6b35;"> Система не инициализирована. Нажмите "Установить начальные данные"</p>';
            }
        };
    </script>
</body>
</html>
